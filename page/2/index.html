<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>n3ird4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="n3ird4">
<meta property="og:url" content="http://91.208.181.214/page/2/index.html">
<meta property="og:site_name" content="n3ird4">
<meta property="og:locale" content="fr">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="n3ird4">
  
    <link rel="alternate" href="/atom.xml" title="n3ird4" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">n3ird4</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Just a blog about SysOps H4c|&lt; and Petanque...</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://91.208.181.214"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Elastic-Stack-Essentials" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/26/Elastic-Stack-Essentials/" class="article-date">
  <time datetime="2020-04-26T10:21:42.000Z" itemprop="datePublished">2020-04-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ElasticSearch/">ElasticSearch</a>►<a class="article-category-link" href="/categories/ElasticSearch/Playing-with-Elastic-Stack-Modules/">Playing with Elastic Stack Modules</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/26/Elastic-Stack-Essentials/">Elastic-Stack-Essentials</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Lab effectué sur <a href="https://linuxacademy.com/" target="_blank" rel="noopener">Linuxacademy</a>.</p>
<p>Le cours <em>Elastic Stack Essentials (Legacy)</em> est une introduction sympa à la stack Elastic qui vous propose après une présentation succinte de<br>Kibana, Logstash, Beats, X-pack etc…de monter un petit cluster de 3 noeuds afin de mettre en pratique et tester ces différents outils. Cool!</p>
<p>Voici la mise en pratique de ce Lab qui va se découper de la manière suivante: </p>
<ul>
<li>Installer ES sur chaque noeuds (Debian 10)</li>
<li>Configurer le cluster (Master / data-node)</li>
<li>Génerer et deployer un certificat sur chaque noeuds</li>
<li>Génerer un mot de passe avec elasticsearch-setup-passwords</li>
<li>Installer Kibana sur le Master node et le connecter à ES</li>
<li>Deployer et configurer metricbeat sur chaque noeuds</li>
<li>Deployer et configurer filebeat sur chaque noeuds</li>
<li>Utiliser Kibana pour visualiser nos dashboards</li>
</ul>
<h3 id="Installer-ES-sur-chaque-noeuds"><a href="#Installer-ES-sur-chaque-noeuds" class="headerlink" title="Installer ES sur chaque noeuds"></a>Installer ES sur chaque noeuds</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html" target="_blank" rel="noopener">source</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install as root</span></span><br><span class="line">sudo su -</span><br><span class="line"><span class="comment"># import GPG key</span></span><br><span class="line">wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</span><br><span class="line"><span class="comment"># Verify that apt-transport-https is already install</span></span><br><span class="line">root@n3ird4:~<span class="comment"># apt-cache policy apt-transport-https</span></span><br><span class="line">apt-transport-https:</span><br><span class="line">  Installed: 1.4.9</span><br><span class="line">  Candidate: 1.4.9</span><br><span class="line">  Version table:</span><br><span class="line"> *** 1.4.9 500</span><br><span class="line">        500 http://deb.debian.org/debian stretch/main amd64 Packages</span><br><span class="line">        500 http://security.debian.org stretch/updates/main amd64 Packages</span><br><span class="line">        100 /var/lib/dpkg/status</span><br><span class="line"><span class="comment"># Create repo definition</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"deb https://artifacts.elastic.co/packages/7.x/apt stable main"</span> | sudo tee <span class="_">-a</span> /etc/apt/sources.list.d/elastic-7.x.list</span><br><span class="line"><span class="comment"># Install ES \o/</span></span><br><span class="line">apt-get update &amp;&amp; apt-get install elasticsearch</span><br><span class="line"><span class="comment"># ES start on boot</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> elasticsearch.service</span><br></pre></td></tr></table></figure>
<h3 id="Configurer-le-cluster-Master-data-node"><a href="#Configurer-le-cluster-Master-data-node" class="headerlink" title="Configurer le cluster (Master / data-node)"></a>Configurer le cluster (Master / data-node)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sur les 3 noeuds il faut éditer le /etc/elasticsearch/elasticsearch.yml tel que :</span></span><br><span class="line">cluster.name: whatever42</span><br><span class="line">network.host: [_local_, _site_]</span><br><span class="line">discovery.seed_hosts: [<span class="string">"XX.XX.XX.XX"</span>] (My master-node private ip Address from Linuxacademy)</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">"master-1"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># puis on passe à la configuration des noeuds un par un :</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sur le master</span></span><br><span class="line">node.name: master-1</span><br><span class="line">node.master: <span class="literal">true</span></span><br><span class="line">node.data: <span class="literal">false</span></span><br><span class="line">node.ingest: <span class="literal">true</span></span><br><span class="line">node.ml: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sur le data-1</span></span><br><span class="line">node.name: data-1</span><br><span class="line">node.master: <span class="literal">false</span></span><br><span class="line">node.data: <span class="literal">true</span></span><br><span class="line">node.ingest: <span class="literal">false</span></span><br><span class="line">node.ml: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sur le data-2</span></span><br><span class="line">node.name: data-2</span><br><span class="line">node.master: <span class="literal">false</span></span><br><span class="line">node.data: <span class="literal">true</span></span><br><span class="line">node.ingest: <span class="literal">false</span></span><br><span class="line">node.ml: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># On start ES</span></span><br><span class="line"></span><br><span class="line">systemctl start elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment"># et on check via l'API cat que tout va bien :</span></span><br><span class="line"></span><br><span class="line">root@n3ird4:~<span class="comment"># curl localhost:9200/_cat/nodes?v</span></span><br><span class="line">ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</span><br><span class="line">172.31.35.158            9          96  60    0.66    0.21     0.08 im        *      master-1</span><br><span class="line">172.31.37.11             8          96  43    0.38    0.14     0.05 d         -      data-1</span><br><span class="line">172.31.39.155            8          97  45    0.50    0.18     0.07 d         -      data-2</span><br><span class="line"></span><br><span class="line"><span class="comment"># au passage petit tip pratique pour lister les commandes dispo de l'API _cat : </span></span><br><span class="line"></span><br><span class="line">root@n3ird4:~<span class="comment"># curl http://localhost:9200/_cat/</span></span><br><span class="line">=^.^=</span><br><span class="line">/_cat/allocation</span><br><span class="line">/_cat/shards</span><br><span class="line">/_cat/shards/&#123;index&#125;</span><br><span class="line">/_cat/master</span><br><span class="line">/_cat/nodes</span><br><span class="line">/_cat/indices</span><br><span class="line">/_cat/indices/&#123;index&#125;</span><br><span class="line">/_cat/segments</span><br><span class="line">/_cat/segments/&#123;index&#125;</span><br><span class="line">/_cat/count</span><br><span class="line">/_cat/count/&#123;index&#125;</span><br><span class="line">/_cat/recovery</span><br><span class="line">/_cat/recovery/&#123;index&#125;</span><br><span class="line">/_cat/health</span><br><span class="line">/_cat/pending_tasks</span><br><span class="line">/_cat/aliases</span><br><span class="line">/_cat/aliases/&#123;<span class="built_in">alias</span>&#125;</span><br><span class="line">/_cat/thread_pool</span><br><span class="line">/_cat/plugins</span><br><span class="line">/_cat/fielddata</span><br><span class="line">/_cat/fielddata/&#123;fields&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Generer-et-deployer-un-certificat-sur-chaque-noeuds-Xpack"><a href="#Generer-et-deployer-un-certificat-sur-chaque-noeuds-Xpack" class="headerlink" title="Génerer et deployer un certificat sur chaque noeuds + Xpack"></a>Génerer et deployer un certificat sur chaque noeuds + Xpack</h3><p>Dans cette partie on apprend comment sécuriser de manière minimale un cluster ES à savoir:</p>
<ul>
<li>Générer un certificat auto-signé</li>
<li>Configurer le plugin ES Security</li>
<li>Activer le chiffrement </li>
<li>Activer l’auth des différents users</li>
<li>Définir les passwords </li>
<li>Interagir avec le cluster de manière “sécurisée” :) </li>
</ul>
<p>/!\ spoiler alert: Ici on cherche à se simplifier la vie donc on va creer un seul certif sur le master pour ensuite le copier sur les data-nodes /!\</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-tls.html#node-certificates" target="_blank" rel="noopener">Doc ES sur la génération de certrif </a><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html#transport-tls-ssl-settings" target="_blank" rel="noopener">Doc ES sur la conf TLS/SSL</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A faire sur chaque noeuds :</span></span><br><span class="line">mkdir /etc/elasticsearch/certs</span><br><span class="line"></span><br><span class="line"><span class="comment"># A faire uniquement depuis le master</span></span><br><span class="line">/usr/share/elasticsearch/bin/elasticsearch-certutil cert --name n3ird4 --out /etc/elasticsearch/certs/n3ird4 (on donne le nom de notre cluster.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># puis on chmod + copie la clé sur les 2 autres noeuds et basta</span></span><br><span class="line"></span><br><span class="line">chmod 640 /etc/elasticsearch/certs/n3ird4</span><br><span class="line"></span><br><span class="line">scp /etc/elasticsearch/certs/development IPdedata-1:/etc/elasticsearch/certs/</span><br><span class="line"></span><br><span class="line">scp /etc/elasticsearch/certs/development IPdedata-2:/etc/elasticsearch/certs/</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On edite à nouveau le elasticsearch.yml sur les 3 noeuds pour activer X-Pack et ajouter:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ---------------------------------- Security ----------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">xpack.security.enabled: <span class="literal">true</span></span><br><span class="line">xpack.security.transport.ssl.enabled: <span class="literal">true</span></span><br><span class="line">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class="line">xpack.security.transport.ssl.keystore.path: certs/n3ird4</span><br><span class="line">xpack.security.transport.ssl.truststore.path: certs/n3ird4</span><br><span class="line"></span><br><span class="line"><span class="comment">#puis on restart ES sur les 3 noeuds dans la foulée pour prendre en compte les modifications:</span></span><br><span class="line"></span><br><span class="line">systemctl restart elasticsearch</span><br></pre></td></tr></table></figure>
<h3 id="Generer-un-mot-de-passe-avec-elasticsearch-setup-passwords"><a href="#Generer-un-mot-de-passe-avec-elasticsearch-setup-passwords" class="headerlink" title="Génerer un mot de passe avec elasticsearch-setup-passwords"></a>Génerer un mot de passe avec elasticsearch-setup-passwords</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cette partie est pas super interessante je passe donc vite :</span></span><br><span class="line"><span class="comment"># A faire depuis le master</span></span><br><span class="line">/usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure>
<h3 id="Installer-Kibana-sur-le-Master-node-et-le-connecter-a-ES-via-le-8080"><a href="#Installer-Kibana-sur-le-Master-node-et-le-connecter-a-ES-via-le-8080" class="headerlink" title="Installer Kibana sur le Master node et le connecter à ES via le 8080:"></a>Installer Kibana sur le Master node et le connecter à ES via le 8080:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apt-get install kibana</span><br><span class="line">systemctl <span class="built_in">enable</span> kibana</span><br><span class="line"></span><br><span class="line">vim /etc/kibana/kibana.yml</span><br><span class="line"></span><br><span class="line">server.port: 8080</span><br><span class="line">server.host: <span class="string">"10.0.1.101"</span></span><br><span class="line">elasticsearch.username: <span class="string">"kibana"</span></span><br><span class="line">elasticsearch.password: <span class="string">"changeme"</span></span><br><span class="line"></span><br><span class="line">systemctl start kibana</span><br></pre></td></tr></table></figure>
<p>Si tout se passe correctement on se connecte au kibana via http://&lt;IP_ADDRESS_OF_MASTER-1&gt;:8080<br>En utilisant le couple user/password généré au préalable (cf: ci-dessus)</p>
<h3 id="Deployer-et-configurer-metricbeat-sur-chaque-noeuds"><a href="#Deployer-et-configurer-metricbeat-sur-chaque-noeuds" class="headerlink" title="Deployer et configurer metricbeat sur chaque noeuds"></a>Deployer et configurer metricbeat sur chaque noeuds</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">apt-get install metricbeat</span><br><span class="line">systemctl <span class="built_in">enable</span> metricbeat</span><br><span class="line"></span><br><span class="line">vim /etc/metricbeat/metricbeat.yml</span><br><span class="line"></span><br><span class="line">setup.kibana:</span><br><span class="line">  host: <span class="string">"10.0.1.101:8080"</span></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">"10.0.1.101:9200"</span>]</span><br><span class="line">  username: <span class="string">"elastic"</span></span><br><span class="line">  password: <span class="string">"changeme"</span></span><br><span class="line"></span><br><span class="line">metricbeat setup</span><br><span class="line">systemctl start metricbeat</span><br></pre></td></tr></table></figure>
<h3 id="Deployer-et-configurer-filebeat-sur-chaque-noeuds"><a href="#Deployer-et-configurer-filebeat-sur-chaque-noeuds" class="headerlink" title="Deployer et configurer filebeat sur chaque noeuds"></a>Deployer et configurer filebeat sur chaque noeuds</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">apt-get install filebeat</span><br><span class="line">systemctl <span class="built_in">enable</span> filebeat</span><br><span class="line"></span><br><span class="line">vim /etc/filebeat/filebeat.yml</span><br><span class="line"></span><br><span class="line">setup.kibana:</span><br><span class="line">  host: <span class="string">"10.0.1.101:8080"</span></span><br><span class="line">output.elasticsearch:</span><br><span class="line">  hosts: [<span class="string">"10.0.1.101:9200"</span>]</span><br><span class="line">  username: <span class="string">"elastic"</span></span><br><span class="line">  password: <span class="string">"changeme"</span></span><br><span class="line"></span><br><span class="line">filebeat modules <span class="built_in">enable</span> system</span><br><span class="line">filebeat setup</span><br><span class="line">systemctl start filebeat</span><br></pre></td></tr></table></figure>
<h3 id="Utiliser-Kibana-pour-visualiser-nos-dashboards"><a href="#Utiliser-Kibana-pour-visualiser-nos-dashboards" class="headerlink" title="Utiliser Kibana pour visualiser nos dashboards"></a>Utiliser Kibana pour visualiser nos dashboards</h3><p>Go sur http://&lt;PUBLIC_IP_ADDRESS_OF_MASTER-1&gt;:8080<br>Puis dans la partie Dasboard =&gt; on cherche “Filebeat System” ou “Metricbeat System”.</p>
<p>Voici quelques exemples on voit qu’on a différents choix possible :</p>
<p><img src="/images/ES_metricbeatsystem.PNG" alt="metricbeat system"></p>
<p>Ici on voit via filebeat des infos intéressantes sur les requêtes malveillantes que reçoit cluster !</p>
<p><img src="/images/ES_sshlogin.PNG" alt="ssh login dash"></p>
<p>Enfin via Metricbeat on a accés à une multitude de…métriques :D </p>
<p><img src="/images/ES_metricbeatECS.PNG" alt="metricbeat ECS"></p>
<p>Enjoy !</p>
<p><img src="https://sourceforge.net/images/icon_linux.gif" alt="Wesh!" title="I&#39;m watching you t&#39;as vu!"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2020/04/26/Elastic-Stack-Essentials/" data-id="clrv2dsdx0004foiyo7mqbvdl" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-IoWait-Ma-Tuer" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/12/IoWait-Ma-Tuer/" class="article-date">
  <time datetime="2020-04-12T15:05:00.000Z" itemprop="datePublished">2020-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Sysadmin-Tips-Tricks/">Sysadmin Tips & Tricks</a>►<a class="article-category-link" href="/categories/Sysadmin-Tips-Tricks/iowait/">iowait</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/12/IoWait-Ma-Tuer/">IoWait ma Tuer</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Cet article n’est pas de moi, je lui rend simplement hommage <a href="https://web.archive.org/web/20170917105833/http://blog.developpeur-neurasthenique.fr:80/auto-hebergement-iowait-ma-tuer-1-2-vmstat-mpstat-atop-pidstat.html" target="_blank" rel="noopener">source</a> </p>
<p>J’apprecie sons bon sens de l’hummour ainsi que sa logique dans la façon de procéder à l’analyse. voici donc son contenu: </p>
<p>Rien à péter, je suis passé au SSD… » (Bernard M., passionné par la fuite en avant)<br>IOwait : le mal aimé</p>
<p>« IOwait correspond au temps d’attente du système pour l’écriture ou la lecture de données. Un IOwait de 10 % signifie que 10 % de l’activité du CPU n’est pas destinée à faire des calculs mais à attendre l’exécution d’une opération de lecture/écriture. » (Wikipedia)</p>
<p>Pour afficher le pourcentage d’IOwait, c’est « vmstat » qui s’y colle :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vmstat 1</span></span><br><span class="line"></span><br><span class="line">procs  -----------memory---------- ---swap-- -----io---- -system-- ----cpu----  </span><br><span class="line">r  b   swpd   free   buff   cache   si   so    bi    bo   <span class="keyword">in</span>   cs  us sy id wa  </span><br><span class="line">1  0   7680  32200 353264 3111032    0    0 17173 19114  752  536   0  3 72 25  </span><br><span class="line">0  1   7680  31124 353376 3114680    0    0 12722 12798  799  569   0  3 75 22  </span><br><span class="line">0  1   7680  32916 353396 3114088    0    0  4592  4689  940  552   0  2 76 22  </span><br><span class="line">0  1   7680  33208 353432 3117292    0    0 20621 20533  739  592   0  4 77 19  </span><br><span class="line">1  1   7680  32096 353448 3119244    0    0 18426 18563  771  592   0  4 77 20</span><br></pre></td></tr></table></figure>
<p>La colonne qui nous intéresse est la dernière, celle qui se nomme « wa ». Plus cette valeur (en pourcentage) est élevée, plus le processeur se tourne les pouces parce que les disques durs sont littéralement à la bourre et n’arrivent pas à suivre la cadence.</p>
<p>Notez que, jusqu’ici tout va bien : « seulement » 20% d’IOwait (mais attendez un peu la suite).<br>IOwait le retour : petite tentative de démystification</p>
<p>La plupart du temps, quand on cherche rapidement des infos sur le sujet, on tombe surtout sur des personnes plus stressées les unes que les autres : « IOwait à 100%, suis-je maudis ? », « Trop d’IOwait, mon serveur rame à mort. » ou encore « J’ai un load average de fou à cause des IOwait, que faire ? ».</p>
<p>Ceci étant, pas de panique car pour réduire les IOwait, il suffit d’appliquer une des solutions suivantes :</p>
<ul>
<li>diminuer le nombre d’accès disque (Super, t’en as d’autres comme ça ?)</li>
<li>augmenter la charge du processeur (Gné ? Keskidi ?)</li>
<li>opter pour un processeur poussif (Chérie, fais gaffe, ce type est complètement con…)</li>
</ul>
<p>Et pourtant, je vous assure que ça marche : installez cpuburn sur un serveur saturé au niveau des IO, lancez autant de burns que le processeur a de coeurs et admirez le résultat.</p>
<p>Félicitations, les IOwait sont maintenant à 0%, n’hésitez pas à demander une augmentation à votre boss…<br>(Cependant, si le CPU crame à cause de vos conneries, ça va être une autre paire de manche)</p>
<p>J’en vois certains qui froncent les sourcils et c’est bien normal : le nombre d’accès disques n’a pas baissé d’un pouce (et le processeur est à bloc), alors c’est quoi l’embrouille ?</p>
<p>IOwait, la vengeance du come back : voyage au centre de la terre du kernel</p>
<p>Maintenant que l’on sait, au moins intuitivement, que l’indicateur d’IOwait est (plus ou moins) foireux, z’allions voir pourquoi.</p>
<p>L’aventure commence, comme d’hab, avec « /proc » :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/stat</span></span><br><span class="line"></span><br><span class="line">cpu   14471379  41901343  7624436  1631039241  4181730  8954  254946  0  0  </span><br><span class="line">cpu0  2230907   8693273   1693928  409959262   1653894  1704  69221   0  0  </span><br><span class="line">cpu1  2183699   8699859   1554726  411272346   1392114  3277  69635   0  0  </span><br><span class="line">cpu2  4914950   12282210  2201785  405373432   646329   2223  62046   0  0  </span><br><span class="line">cpu3  5141820   12226000  2173996  404434200   489391   1749  54042   0  0  </span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>En fonction du noyau utilisé, le nombre de colonnes varie, « man 5 proc » est votre ami :</p>
<p><em>/proc/stat<br>kernel/system statistics. Varies with architecture. Common entries include:<br>cpu  3357 0 4313 1362393</em></p>
<p>_The amount of time, measured in units of USERi HZ (1/100ths of a second on most architectures, use sysconf(_SC__CLK__TCK_) to obtain the right value), that the system spent in user mode, user mode with low priority (nice), system mode, and the idle task, respectively. The last value should be USER_HZ_ times the second entry in the uptime pseudo-file_</p>
<p><em>In Linux 2.6 this line includes three additional columns: iowait – time waiting for I/O to complete (since 2.5.41); irq – time servicing interrupts (since 2.6.0-test4); softirq – time servicing softirqs (since 2.6.0-test4).</em></p>
<p><em>Since Linux 2.6.11, there is an eighth column, steal – stolen time, which is the time spent in other operating systems when running in a virtualized environment</em></p>
<p><em>Since Linux 2.6.24, there is a ninth column, guest, which is the time spent running a virtual CPU for guest operating systems under the control of the Linux kernel.</em></p>
<p>La nobox tournant avec une Debian Squeeze, la version du noyau est 2.6.32-41, le nombre de colonnes est donc égal à 9. Et si on veut savoir à quoi correspondent ces fameuses colonnes, suffit d’appeler Luke à la rescousse :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 'kernel_stat.h' contains the definitions needed for doing</span></span><br><span class="line"><span class="comment"> * some kernel statistics (CPU usage, context switches ...),</span></span><br><span class="line"><span class="comment"> * used by rstatd/perfmeter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> cpu_usage_stat &#123;  </span><br><span class="line">  <span class="keyword">cputime64_t</span> user;</span><br><span class="line">  <span class="keyword">cputime64_t</span> nice;</span><br><span class="line">  <span class="keyword">cputime64_t</span> system;</span><br><span class="line">  <span class="keyword">cputime64_t</span> softirq;</span><br><span class="line">  <span class="keyword">cputime64_t</span> irq;</span><br><span class="line">  <span class="keyword">cputime64_t</span> idle;</span><br><span class="line">  <span class="keyword">cputime64_t</span> iowait;</span><br><span class="line">  <span class="keyword">cputime64_t</span> steal;</span><br><span class="line">  <span class="keyword">cputime64_t</span> guest;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Bon, ok, vu du noyau, z’avions les différents « états » de chaque processeur.<br>Maintenant, ce qui nous intéresse, c’est de savoir comment iowait est incrémenté.</p>
<p>Et là, même punition, Luke s’y colle à nouveau:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Account for idle time.</span></span><br><span class="line"><span class="comment"> * @cputime: the cpu time spent in idle wait</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">account_idle_time</span><span class="params">(<span class="keyword">cputime_t</span> cputime)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">struct</span> cpu_usage_stat *cpustat = &amp;amp;kstat_this_cpu.cpustat;</span><br><span class="line">  <span class="keyword">cputime64_t</span> cputime64 = cputime_to_cputime64(cputime);</span><br><span class="line">  <span class="keyword">struct</span> rq *rq = this_rq();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (atomic_read(&amp;amp;rq-&amp;gt;nr_iowait) &amp;gt; <span class="number">0</span>)</span><br><span class="line">    cpustat-&amp;gt;iowait = cputime64_add(cpustat-&amp;gt;iowait, cputime64);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    cpustat-&amp;gt;idle = cputime64_add(cpustat-&amp;gt;idle, cputime64);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>En français dans le texte, ça nous donne ceci : si un CPU est « idle » (il n’a rien à faire) et qu’il y a des entrées/sorties en attente, alors le compteur « iowait » est incrémenté, sinon c’est le compteur « idle » qui est incrémenté.</p>
<p>Je vous la refais en plus clair : le compteur « iowait » ne peut être incrémenté que si le CPU est « idle ».</p>
<p>Nan, toujours pas ? Bon, ok : si un CPU est utilisé à 100%, il ne peut pas être « idle » donc l’iowait est forcément nul.</p>
<p>Ce qui nous amène aux conclusions suivantes :</p>
<ul>
<li>Plus le processeur utilisé est puissant, plus les IOwait seront élevés (à charge égale)</li>
<li>Un serveur « CPU bound » aura des IOwait très faibles même si les disques sont débordés</li>
<li>En résumé, l’indicateur IOwait ne permet pas de savoir à coup sûr si les disques limitent les performances</li>
</ul>
<p>Super, nous voilà bien avancé. Z’allions donc passer aux choses sérieuses.<br>IOwait, ze ultimate return même qu’il est pas content : mpstat</p>
<p>Sous Debian, mptstat fait partie du package sysstat : « apt-get install sysstat ».</p>
<p>Si vous vous souvenez du début de l’article, vous aurez constaté que la commande « vmstat » n’indiquait que 20% d’IOwait, pas de quoi fouetter un chat pourrait-on se dire.</p>
<p>Erreur… En fait, le système copiait un dossier vers un autre (« cp -a mon-gros-dossier copie-de-gros-dossier ») et, dans ce cas de figure, ce sont bien les disques qui ralentissent la copie. (On dit alors que le système est « IO bound » ).</p>
<p>Donc, même avec un tout petit processeur (Atom D525 1.8 Ghz : 2 coeurs + hyperthreading), il est nécessaire de surveiller à la loupe chaque coeur :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mpstat -P ALL 5</span></span><br><span class="line"></span><br><span class="line">Linux 2.6.32-5-amd64 (www.nobox.lan)       02/29/2012      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">02:02:04 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle  </span><br><span class="line">02:02:09 PM  all    0.10    0.00    2.62   21.19    0.10    0.30    0.00    0.00   75.70  </span><br><span class="line">02:02:09 PM    0    0.40    0.00    6.15   63.10    0.00    0.60    0.00    0.00   29.76  </span><br><span class="line">02:02:09 PM    1    0.00    0.00    0.20    0.98    0.20    0.00    0.00    0.00   98.63  </span><br><span class="line">02:02:09 PM    2    0.00    0.00    4.13   21.06    0.20    0.39    0.00    0.00   74.21  </span><br><span class="line">02:02:09 PM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00</span><br><span class="line"></span><br><span class="line">02:02:09 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle  </span><br><span class="line">02:02:14 PM  all    2.23    0.00    2.67   23.32    0.20    0.35    0.00    0.00   71.24  </span><br><span class="line">02:02:14 PM    0    0.60    0.00    6.79   66.67    0.40    1.00    0.00    0.00   24.55  </span><br><span class="line">02:02:14 PM    1    8.12    0.00    0.59    0.00    0.20    0.00    0.00    0.00   91.09  </span><br><span class="line">02:02:14 PM    2    0.20    0.00    3.36   21.15    0.20    0.59    0.00    0.00   74.51  </span><br><span class="line">02:02:14 PM    3    0.00    0.00    0.00    5.88    0.00    0.00    0.00    0.00   94.12</span><br><span class="line"></span><br><span class="line">02:02:14 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle  </span><br><span class="line">02:02:19 PM  all    0.10    0.00    2.73   22.23    0.20    0.25    0.00    0.00   74.49  </span><br><span class="line">02:02:19 PM    0    0.20    0.00    7.36   63.02    0.20    0.99    0.00    0.00   28.23  </span><br><span class="line">02:02:19 PM    1    0.00    0.00    0.00    1.58    0.40    0.00    0.00    0.00   98.02  </span><br><span class="line">02:02:19 PM    2    0.20    0.00    3.74   24.21    0.20    0.20    0.00    0.00   71.46  </span><br><span class="line">02:02:19 PM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00</span><br></pre></td></tr></table></figure>
<p>La seconde ligne (CPU all) de chaque bloc nous indique la moyenne des CPU (tout comme vmstat) mais on s’en contrefiche : regardez plutôt les IOwait de chaque coeur et en particulier celui du CPU 0.</p>
<p>Tout de suite c’est moins folichon : il n’y a qu’un seul coeur qui bosse vraiment(cf:1) et pas de chance, il passe plus de 60% de son temps à attendre que les IO en cours se terminent. Mais dormez tranquilles braves gens, l’IOwait moyen n’est que de 20%…</p>
<p>Formidable, tout ça c’est très joli sauf que, trop souvent, on ne sait pas à quelle sauce les disques durs sont mangés ni qui est le coupable : il est temps de passer à la chasse à l’homme.<br>IOwait, randonnée pour un tueur : iotop, atop et pidstat à la rescousse</p>
<p>Se promener dans les bois c’est bien, trouver une proie pour se faire un casse-croute aux fines herbes (et, soyons fou, avec un peu de mayo), c’est quand même mieux : « apt-get install iotop ».</p>
<p>Histoire d’avoir quelque chose à se mettre sous la prémolaire, pour changer, on va lancer une compilation du noyau (« make-kpkg –initrd kernel_image »)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iotop -ako</span></span><br><span class="line"></span><br><span class="line">Total DISK READ: 0.00 K/s | Total DISK WRITE: 1272.82 K/s  </span><br><span class="line">TID   PRIO USER       DISK READ  DISK WRITE  SWAPIN     IO&amp;gt;   COMMAND  </span><br><span class="line">762   be/3 root          0.00 K    340.00 K  0.00 %  2.26 %   [jbd2/sda9-8]  </span><br><span class="line">777   be/3 root          0.00 K    160.00 K  0.00 %  0.97 %   [jbd2/sda7-8]  </span><br><span class="line">782   be/3 root          0.00 K    580.00 K  0.00 %  0.93 %   [jbd2/sda8-8]  </span><br><span class="line">772   be/3 root          0.00 K     44.00 K  0.00 %  0.30 %   [jbd2/sda6-8]  </span><br><span class="line">4918  be/4 postfix       4.00 K     24.00 K  0.00 %  0.04 %   cleanup -z -t unix -u -c  </span><br><span class="line">548   be/4 root          0.00 K    172.00 K  0.00 %  0.02 %   [flush-8:0]  </span><br><span class="line">7795  be/4 bdd-mysq      4.00 K     12.00 K  0.00 %  0.02 %   mysqld --basedir=/var/jail/ --datadir=[...]  </span><br><span class="line">4919  be/4 postfix       8.00 K     52.00 K  0.00 %  0.02 %   virtual -t unix  </span><br><span class="line">7686  be/4 bdd-mysq      0.00 K     92.00 K  0.00 %  0.00 %   mysqld --basedir=/var/jail/ --datadir=[...]  </span><br><span class="line">14190 be/4 mails         0.00 K     88.00 K  0.00 %  0.00 %   imap [xxxxxxxx@xxxxxxxxxx.fr xxx.xxx.xx.xxx]  </span><br><span class="line">12084 be/4 mails         0.00 K     40.00 K  0.00 %  0.00 %   imap [xxxxxxxx@xxxxxxxxxx.fr xxx.xxx.xx.xxx]  </span><br><span class="line">7679  be/4 bdd-mysq      0.00 K      4.00 K  0.00 %  0.00 %   mysqld --basedir=/var/jail/ --datadir=[...]  </span><br><span class="line">4377  be/4 root          0.00 K     76.00 K  0.00 %  0.00 %   rsyslogd -c4  </span><br><span class="line">31337 be/4 bdd-mysq      0.00 K      0.00 K  0.00 %  0.00 %   mysqld --basedir=/var/jail/ --datadir=[...]  </span><br><span class="line">25511 be/4 opendkim      0.00 K     28.00 K  0.00 %  0.00 %   opendkim -x /etc/opendkim.conf -u [...]  </span><br><span class="line">19797 be/4 root          0.00 K     12.00 K  0.00 %  0.00 %   vlogger (error <span class="built_in">log</span>)  </span><br><span class="line">19799 be/4 root          0.00 K     32.00 K  0.00 %  0.00 %   vlogger (access <span class="built_in">log</span>)  </span><br><span class="line">7681  be/4 bdd-mysq      0.00 K     80.00 K  0.00 %  0.00 %   mysqld --basedir=/var/jail/ --datadir=[...]  </span><br><span class="line">7685  be/4 bdd-mysq      0.00 K      8.00 K  0.00 %  0.00 %   mysqld --basedir=/var/jail/ --datadir=[...]  </span><br><span class="line">7933  be/4 root          0.00 K      8.00 K  0.00 %  0.00 %   dovecot -c /etc/dovecot/dovecot.conf  </span><br><span class="line">12080 be/4 mails         0.00 K      4.00 K  0.00 %  0.00 %   imap [xxxxxg@xxxxxxxxx.fr xxx.xxx.xx.xxx]  </span><br><span class="line">24558 be/4 www-blog      0.00 K     12.00 K  0.00 %  0.00 %   php5-cgi  </span><br><span class="line">25512 be/4 opendkim      0.00 K      0.00 K  0.00 %  0.00 %   opendkim -x /etc/opendkim.conf -u [...]</span><br></pre></td></tr></table></figure>
<p>M’ouais… Je sais pas pour vous mais de mon côté, je ne vois rien d’excitant et encore moins les processus nécessaires à la compilation du noyau. Je n’ai pas creusé mais il semblerait qu’iotop n’affiche pas tous les processus effectuant des entrées/sorties. (Si quelqu’un a plus d’infos, je suis preneur !)</p>
<p>Pas grave, essayons autre chose : « apt-get install atop » :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># atop -c -d 5</span></span><br><span class="line"></span><br><span class="line">ATOP - www                2012/02/29  07:53:17                5 seconds elapsed  </span><br><span class="line">PRC | sys   0.33s | user   5.15s | <span class="comment">#proc    210 | #zombie    0 | #exit     48 |  </span></span><br><span class="line">CPU | sys     10% | user    104% | irq       1% | idle    284% | <span class="built_in">wait</span>      1% |  </span><br><span class="line">cpu | sys      6% | user     87% | irq       0% | idle      7% | cpu002 w  0% |  </span><br><span class="line">cpu | sys      2% | user      8% | irq       0% | idle     88% | cpu001 w  1% |  </span><br><span class="line">cpu | sys      1% | user      8% | irq       0% | idle     91% | cpu000 w  0% |  </span><br><span class="line">cpu | sys      1% | user      1% | irq       0% | idle     97% | cpu003 w  0% |  </span><br><span class="line">CPL | avg1   1.09 | avg5    1.38 | avg15   1.19 | csw     1216 | intr    3907 |  </span><br><span class="line">MEM | tot    3.9G | free  664.6M | cache   1.9G | buff  652.5M | slab  252.4M |  </span><br><span class="line">SWP | tot    4.0G | free    4.0G |              | vmcom   2.2G | vmlim   5.9G |  </span><br><span class="line">DSK |         sda | busy      2% | <span class="built_in">read</span>       9 | write     19 | avio    3 ms |  </span><br><span class="line">NET | transport   | tcpi     102 | tcpo     192 | udpi       0 | udpo       0 |  </span><br><span class="line">NET | network     | ipi      260 | ipo      350 | ipfrw    158 | deliv    102 |  </span><br><span class="line">NET | eth0     0% | pcki     264 | pcko     355 | si  244 Kbps | so  652 Kbps |  </span><br><span class="line">NET | ifb0   ---- | pcki     233 | pcko     233 | si  419 Kbps | so  419 Kbps |  </span><br><span class="line">NET | ifb2   ---- | pcki     121 | pcko     121 | si  230 Kbps | so  230 Kbps |</span><br><span class="line"></span><br><span class="line">PID  DSK COMMAND-LINE                                                  1/3  </span><br><span class="line">26991  96% /usr/bin/make <span class="_">-f</span> scripts/Makefile.build obj=arch/x86/kernel  </span><br><span class="line">12719   2% rsync --server --sender -vlogDtpre.iLsf --bwlimit=48 . /home/backup/  </span><br><span class="line">777     2% jbd2/sda7-8  </span><br><span class="line">762     0% jbd2/sda9-8  </span><br><span class="line">27030   0% &amp;lt;cc1&amp;gt;  </span><br><span class="line">27044   0% &amp;lt;cc1&amp;gt;  </span><br><span class="line">27058   0% &amp;lt;cc1&amp;gt;  </span><br><span class="line">27072   0% /usr/lib/gcc/x86_64-linux-gnu/4.4.5/cc1 -quiet -nostdinc -Iinclude -  </span><br><span class="line">27036   0% &amp;lt;cc1&amp;gt;  </span><br><span class="line">27050   0% &amp;lt;cc1&amp;gt;  </span><br><span class="line">27035   0% &amp;lt;genksyms&amp;gt;  </span><br><span class="line">27064   0% &amp;lt;cc1&amp;gt;  </span><br><span class="line">27049   0% &amp;lt;genksyms&amp;gt;  </span><br><span class="line">27063   0% &amp;lt;genksyms&amp;gt;  </span><br><span class="line">27031   0% &amp;lt;as&amp;gt;  </span><br><span class="line">20630   0% atop <span class="_">-d</span> -c 5  </span><br><span class="line">27045   0% &amp;lt;as&amp;gt;  </span><br><span class="line">27059   0% &amp;lt;as&amp;gt;  </span><br><span class="line">12703   0% sshd: root@notty  </span><br><span class="line">27024   0% &amp;lt;as --gdwarf2 -Qy --64 -o arch/x86/kernel/entry_64.o /tmp/cc697jEh.&amp;gt;  </span><br><span class="line">27039   0% &amp;lt;fixdep&amp;gt;  </span><br><span class="line">27053   0% &amp;lt;fixdep&amp;gt;  </span><br><span class="line">27067   0% &amp;lt;fixdep&amp;gt;  </span><br><span class="line">21223   0% /usr/sbin/munin-node  </span><br><span class="line">27073   0% as -Qy --64 -o arch/x86/kernel/.tmp_dumpstack_64.o -  </span><br><span class="line">3721    0% imap-login</span><br></pre></td></tr></table></figure>
<p>Ha, enfin ! Notre grand gagnant de la semaine est le processus 26991. Zoomons un peu sur ce mécréant :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pidstat -d -p 26991 5</span></span><br><span class="line"></span><br><span class="line">Linux 2.6.32-5-amd64 (www.nobox.lan)       02/29/2012      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">07:54:42 AM       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command  </span><br><span class="line">07:54:47 AM     26991      0.00    315.20    132.80  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]  </span><br><span class="line">07:54:52 AM     26991      0.00    197.60     44.80  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]  </span><br><span class="line">07:54:57 AM     26991      0.00    185.60     50.40  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]  </span><br><span class="line">07:55:02 AM     26991      0.00    251.20     85.60  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]  </span><br><span class="line">07:55:07 AM     26991      0.00    204.80     68.00  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]  </span><br><span class="line">07:55:12 AM     26991      0.00    109.60      8.80  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]  </span><br><span class="line">07:55:17 AM     26991      0.00    132.80      8.00  /usr/bin/make <span class="_">-f</span> scripts/Makefile.build [...]</span><br></pre></td></tr></table></figure>
<p>Voilà, fin de l’histoire : on apprend que « make » se promène tranquillement (dans les bois) tout en écrivant environ 200 Ko/s.</p>
<p>Ceci étant, au lieu de surveiller un seul processus, on peut aussi demander à voir l’activité globale avec « pidstat -d -l 5 » :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pidstat -d -l 5</span></span><br><span class="line"></span><br><span class="line">08:13:26 AM       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command  </span><br><span class="line">08:13:31 AM       762      0.00     24.51      0.00  jbd2/sda9-8  </span><br><span class="line">08:13:31 AM       782      0.00      0.79      0.00  jbd2/sda8-8  </span><br><span class="line">08:13:31 AM     19222  13796.84  14118.58      0.00  cp <span class="_">-a</span> gros-backup copie-de-gros-backup</span><br><span class="line"></span><br><span class="line">08:13:31 AM       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command  </span><br><span class="line">08:13:36 AM       762      0.00     15.20      0.00  jbd2/sda9-8  </span><br><span class="line">08:13:36 AM      1038      0.00      1.60      0.00  /usr/sbin/rsyslogd -c4  </span><br><span class="line">08:13:36 AM      5780      0.00      0.80      0.00  /usr/sbin/nmbd -D  </span><br><span class="line">08:13:36 AM     16095     32.80     20.80      0.80  /usr/lib/postfix/master  </span><br><span class="line">08:13:36 AM     19222  19984.00  19984.00      0.00  cp <span class="_">-a</span> gros-backup copie-de-gros-backup</span><br><span class="line"></span><br><span class="line">08:13:36 AM       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command  </span><br><span class="line">08:13:41 AM       762      0.00     13.60      0.00  jbd2/sda9-8  </span><br><span class="line">08:13:41 AM       782      0.00      3.20      0.00  jbd2/sda8-8  </span><br><span class="line">08:13:41 AM     16095      2.40      0.00      0.00  /usr/lib/postfix/master  </span><br><span class="line">08:13:41 AM     19222   8874.40   8993.60      0.00  cp <span class="_">-a</span> gros-backup copie-de-gros-backup</span><br></pre></td></tr></table></figure>
<p>Pour ceux qui viennent juste de comprendre, oui, depuis le début du billet et mis à part la compilation du kernel, tous les exemples sont basés sur « cp -a gros-backup copie-de-gros-backup » (mais, dans la seconde partie, on va varier les plaisirs car sinon c’est pas drôle).<br>The end ?</p>
<p>Non, suite au prochain numéro : il sera question d’IOPS, d’iostat et de plus si affinités…</p>
<p>A+</p>
<p> (1)   ainsi que le CPU 2 mais, sauf erreur, il s’agit du même coeur (Hyperthreading) ↩</p>
<p>Date de prescription :     29 février 2012<br>Effets secondaires :     Auto-hébergement<br>Médecin traitant :     tranxene50  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2020/04/12/IoWait-Ma-Tuer/" data-id="clrv2dshy003pfoiyk815y5cn" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iotop/">iotop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iowait/">iowait</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vmstat/">vmstat</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-swap" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/11/swap/" class="article-date">
  <time datetime="2020-04-11T00:14:00.000Z" itemprop="datePublished">2020-04-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Sysadmin-Tips-Tricks/">Sysadmin Tips & Tricks</a>►<a class="article-category-link" href="/categories/Sysadmin-Tips-Tricks/swap/">swap</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/11/swap/">Swap &amp; CO</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Afficher-les-processus-consommateurs-de-SWAP"><a href="#Afficher-les-processus-consommateurs-de-SWAP" class="headerlink" title="Afficher les processus consommateurs de SWAP"></a>Afficher les processus consommateurs de SWAP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /proc/*/status ; <span class="keyword">do</span> awk <span class="string">'/VmSwap|Name/&#123;printf $2 " " $3&#125;END&#123; print ""&#125;'</span> <span class="variable">$file</span>; <span class="keyword">done</span> | sort -k 2 -n -r | head -10</span><br></pre></td></tr></table></figure>
<h3 id="Clean-swap-area-after-using-a-memory-hogging-application"><a href="#Clean-swap-area-after-using-a-memory-hogging-application" class="headerlink" title="Clean swap area after using a memory hogging application"></a>Clean swap area after using a memory hogging application</h3><p><em>When you run a memory intensive application (large java application, etc) swap area is used as soon as memory becomes insufficient. After you close the program, the data in swap is not put back on memory and that decreases the responsiveness. Swapoff disables the swap area and forces system to put swap data be placed in memory. Since running without a swap area might be detrimental, swapon should be used to activate swap again. Both swapoff and swapon require root privileges.</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapoff <span class="_">-a</span> &amp;&amp; swapon <span class="_">-a</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-your-swappiness-Ratio-under-linux"><a href="#Change-your-swappiness-Ratio-under-linux" class="headerlink" title="Change your swappiness Ratio under linux"></a>Change your swappiness Ratio under linux</h3><p><em>This command allow you to set the swappiness var at XX (default is 60). The value interval must be set between 0 and 100. If swappiness is high=Sw+ap usage is high, if swappiness is low=Ram usage is high.</em></p>
<p>check via un sysctl -a si le vm.swappiness = 0 cela signifie que l’instance ne doit pas swap tant qu’il reste de le RAM de libre !</p>
<p>Sinon y a toujours la bonne vielle methode du swapfile ^^</p>
<p><a href="https://www.commandlinefu.com/commands/matching/swap/c3dhcA==/sort-by-votes" target="_blank" rel="noopener">Sources</a></p>
<p><img src="https://sourceforge.net/images/icon_linux.gif" alt="I&#39;m watching you!" title="I&#39;m watching you!"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2020/04/11/swap/" data-id="clrv2dsf00010foiyjidvk990" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swap/">swap</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Source-Control-with-Git" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/24/Source-Control-with-Git/" class="article-date">
  <time datetime="2019-11-24T15:20:42.000Z" itemprop="datePublished">2019-11-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Git/">Git</a>►<a class="article-category-link" href="/categories/Git/Source-Control-with-Git/">Source Control with Git</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/24/Source-Control-with-Git/">Source Control with Git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Source: <a href="https://linuxacademy.com/cp/courses/lesson/course/1970/lesson/7/module/195" target="_blank" rel="noopener">LinuxAcademy</a></p>
<ul>
<li>simple tutorial in order to understand Git.</li>
<li>Need some prerequisites (confident with command lines and Linux OS)</li>
</ul>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><p> We will cover :</p>
<ul>
<li>Git Architecture.</li>
<li>Working with local and remote Git repositories.</li>
<li>Adding and tracking files with Git.</li>
<li>Changing a project via forking rebasing and tagging releases.</li>
<li>Install a Gitlab server.</li>
</ul>
<h2 id="Installation-of-Git-on-Debian"><a href="#Installation-of-Git-on-Debian" class="headerlink" title="Installation of Git on Debian"></a>Installation of Git on Debian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install git</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>
<h2 id="The-Basics-of-Using-Git"><a href="#The-Basics-of-Using-Git" class="headerlink" title="The Basics of Using Git"></a>The Basics of Using Git</h2><p>1) Understanding teh Git File System</p>
<p>.git directory / staging area / branch</p>
<p>ls .git/<br>COMMIT_EDITMSG  =&gt; plain text file containing each commit to the repository.<br>head            =&gt; plain text file reference the current branch that we are working on.<br>config          =&gt; configuration info about the repository (dev username and email address…)<br>description     =&gt; plain text file that contains the name of the repository.<br>hooks/          =&gt; contains scripts that you can create to setup some automatic tasks.<br>index           =&gt; keeps tracks of the item in our staging area and of file ready to be commited.<br>info/           =&gt; Contains item such as an exclude file which dicted what files that git will ignore (we’ll use a .gitignore file instead)<br>logs/           =&gt; Contains the log file for teh activity that goes on within the Git repo (commit &amp; changing to the project)<br>objects/        =&gt; Database of compressed file that are hash versions of content of files that have been commited to the repo.<br>                  (The index file is the link between this database and what is currently sitting in the wokring directory)<br>refs/           =&gt; Contains ref file and folders for the branches and tags of your repo.</p>
<p>2) creating a local repository (empty)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git init MySuperRepo</span><br><span class="line"></span><br><span class="line">git init --bare big-project.git</span><br><span class="line">rm -rf big-project.git</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init /path/to/dircetory</span><br><span class="line"><span class="comment"># initializes a git repo, either by creating a new directory or adding the git repo files to an existing directory</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init --bare /path/to/directory</span><br><span class="line"><span class="comment"># initializes a bare git repository, for larger projects, contains no working area.</span></span><br></pre></td></tr></table></figure>
<p>We use this type of repositories when we manage project that have branches for the project coming in for different people.<br>A bare repo has no working area and is typically used on servers where other contributors to the project are going to do pushes and pulls.<br>We also do not need to use the .git file extension for the directory name but is good practice to help distinguish this directory type from a git repository that has a working area.</p>
<p>3) Basic Configuration of Git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">"King 42"</span></span><br><span class="line">git config --global user.email <span class="string">"king@42.com"</span></span><br><span class="line"><span class="comment"># git config user.email "tonton@tahu.com" =&gt; to change only for the current project</span></span><br><span class="line"><span class="comment"># git config user.email</span></span><br><span class="line">git config --global core.editor <span class="string">"/usr/bin/vim"</span></span><br><span class="line">git config --list</span><br><span class="line">cat ~/.gitconfig</span><br></pre></td></tr></table></figure>
<p>4) Adding Files to a Project</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">README.md</span><br><span class="line">$ git add README.md</span><br><span class="line">$ git status (show staging area)</span><br><span class="line">$ git status <span class="_">-s</span></span><br><span class="line">$ mkdir src</span><br><span class="line">$ git add src/</span><br><span class="line">$ git status (does not show empty directorires)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"42"</span> &gt; toto.txt</span><br><span class="line">$ mv toto.txt src/</span><br><span class="line">$ git add src/toto.txt</span><br><span class="line">$ git status (now shoes the src dircetory \o/)</span><br><span class="line"></span><br><span class="line"><span class="comment"># an other method for empty folder to be visible in the repo</span></span><br><span class="line">$ touch src/.keep</span><br><span class="line">$ git add src/.keep</span><br><span class="line">$ git rm src/.keep /!\ does not work as there are no commit <span class="keyword">in</span> there.</span><br><span class="line">$ git rm <span class="_">-f</span> src/.keep</span><br><span class="line">$ ls <span class="_">-a</span> src/</span><br></pre></td></tr></table></figure>
<p>5) The Status of Your Project</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ touch toto</span><br><span class="line">$ git status</span><br><span class="line">$ git status <span class="_">-s</span></span><br><span class="line">$ git add toto</span><br><span class="line">$ git status</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"hello world"</span> &gt; toto</span><br><span class="line">$ git status</span><br><span class="line">$ git status <span class="_">-s</span></span><br><span class="line">$ git add toto</span><br><span class="line">$ git status <span class="_">-s</span></span><br><span class="line">$ git status</span><br><span class="line">$ git status -v</span><br><span class="line">$ git status</span><br></pre></td></tr></table></figure>
<p>6) Committing to Git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">"blablabla"</span></span><br><span class="line">$ cat .git/COMMIT_EDITMSG</span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">$ ls .git/objects/42/ (id from the <span class="built_in">hash</span>)</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>7) Ignoring Certain File types</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/info/exclude</span><br><span class="line">$ mkdir build</span><br><span class="line">$ touch .gitignore</span><br><span class="line">$ git add .gitignore</span><br><span class="line">$ git status</span><br><span class="line">$ git commit -m <span class="string">"adding a .gitignore file"</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"build/*"</span> &gt; .gitignore</span><br><span class="line">$ git status</span><br><span class="line">$ git commit -m <span class="string">"updated our .gitignore file to exclude build directory"</span></span><br><span class="line">$ [build something <span class="keyword">in</span> build directory]</span><br><span class="line">$ git status (directory is clean)</span><br><span class="line">$ vim CHANEGLOG.md (<span class="built_in">set</span> backup + add some lines)</span><br><span class="line">$ git status</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"*~"</span> &gt;&gt; .gitignore (CHANEGLOG.md~)</span><br><span class="line">$ git commit <span class="_">-a</span> -m <span class="string">"updated changelog, and ignoring vim backup files in gitignore"</span></span><br><span class="line">$ git status (directory is clean)</span><br><span class="line">$ git check-ignore *~ (show CHANEGLOG.md~)</span><br></pre></td></tr></table></figure>
<h2 id="Tags-Branching-Merging-and-Reverting"><a href="#Tags-Branching-Merging-and-Reverting" class="headerlink" title="Tags, Branching, Merging and Reverting"></a>Tags, Branching, Merging and Reverting</h2><p>1) Using Tags</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git tag <span class="_">-a</span> v0.1 -m <span class="string">"First tag for the project"</span> (create an unsigned, annotated tag)</span><br><span class="line">$ git tag</span><br><span class="line">$ git show v0.1</span><br><span class="line">- annotated tag contains full objects and a database of your commits. Including information about who created a tag and it is also checksumed</span><br><span class="line">- lightweight tag more <span class="keyword">for</span> private or Temporarily labour.</span><br><span class="line">- git tag create a lightweight tag by default</span><br><span class="line">- you can delete a tag like this:</span><br><span class="line">$ git tag <span class="_">-d</span> v0.1</span><br><span class="line">$ git tag</span><br></pre></td></tr></table></figure>
<p>2) Using Branches</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git branch &lt;branch-name&gt; : creates a new branche of the project tree</span><br><span class="line">$ git checkout &lt;branch name&gt; : switches to another branch</span><br><span class="line">$ HEAD : pointer to the current branch being worked on, can use git <span class="built_in">log</span> and git statust to view <span class="built_in">which</span> branch HEAD is pointing to.</span><br><span class="line"></span><br><span class="line">$ git branch dev</span><br><span class="line">$ git status</span><br><span class="line">$ git checkout dev</span><br><span class="line">$ git status</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"new blablabla"</span> &gt;&gt; CHANEGLOG.md</span><br><span class="line">$ git commit <span class="_">-a</span> -m <span class="string">"adding blablabla to changelog"</span></span><br><span class="line">$ vim CHANEGLOG.md and modify it</span><br><span class="line">$ git commit <span class="_">-a</span> -m <span class="string">"fixed up blablabla"</span></span><br><span class="line">$ git status</span><br><span class="line">$ git checkout master</span><br><span class="line">$ cat CHANGELOG.md (HEAD is pointing back to the last commit on master so lets <span class="keyword">do</span> :)</span><br><span class="line">$ git checkout dev</span><br><span class="line">$ cat CHANGELOG.md (HEAD is pointing to the last commit hence we can see our modifications)</span><br></pre></td></tr></table></figure>
<p>3) Merging Branches</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git status (check on <span class="built_in">which</span> branch you are ie: master aka main)</span><br><span class="line">$ git merge dev</span><br><span class="line">$ git branch <span class="_">-d</span> (to delete a branch)</span><br><span class="line">$ git merge toll may helps you</span><br></pre></td></tr></table></figure>
<p>4) Rebasing (Alternative to merging is rebasing)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout dev</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"blablablalb"</span> &gt; README.md</span><br><span class="line">$ git status</span><br><span class="line">$ git commit <span class="_">-a</span> -m <span class="string">"upadated readme file"</span></span><br><span class="line">$ git checkout master</span><br><span class="line">Now instead of merging we gonna rebase.</span><br><span class="line">$ git rebase dev (apply our modification on the master branch)</span><br><span class="line">$ ls</span><br><span class="line">$ cat README.md</span><br><span class="line"></span><br><span class="line">Why doing rebase instead of merge ?</span><br><span class="line">merging show a fully accurate <span class="built_in">history</span> of your project .</span><br><span class="line">rebasing provide something of a falsify record to show a cleaner history.</span><br><span class="line"></span><br><span class="line">Be sure to rebase only what you have worked on. And not whit commits from outside of your repository.</span><br></pre></td></tr></table></figure>
<p>5) Reverting a Commit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"lkjshedflkshedrfkjhffdfà"</span> &gt;&gt; README.md</span><br><span class="line">$ git commit <span class="_">-a</span> -m <span class="string">"update readme file"</span></span><br><span class="line">$ git revert HEAD</span><br><span class="line">$ cat README.md</span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">$ git revert HEAD~42 =&gt; modifiy the 42 commits before the HEAD</span><br></pre></td></tr></table></figure>
<p>6) Using ‘diff’ command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"modify me"</span> &gt;&gt; CHANGELOG.md</span><br><span class="line">$ git diff</span><br><span class="line">$ git diff HEAD^ HEAD</span><br><span class="line">$ git diff --summary hashid hashid</span><br><span class="line">$ man git-diff</span><br></pre></td></tr></table></figure>
<p>7) How garbage collection works</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git gc --prune (man git)</span><br><span class="line">$ git gc --auto</span><br><span class="line">$ git config gc.pruneexpire <span class="string">"30 days"</span></span><br></pre></td></tr></table></figure>
<h2 id="Git’s-Logs-and-Auditing"><a href="#Git’s-Logs-and-Auditing" class="headerlink" title="Git’s Logs and Auditing"></a>Git’s Logs and Auditing</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph</span><br><span class="line">$ git <span class="built_in">log</span> --grap --since=<span class="string">"42 days ago"</span></span><br><span class="line">$ git <span class="built_in">log</span> -S toto =&gt; shows commits with the word toto</span><br><span class="line">$ git <span class="built_in">log</span> --pretty=format:<span class="string">"%h - %an - %ar - %s"</span> (<span class="built_in">hash</span> / author / relative time / subject )</span><br><span class="line">$ =&gt; Install oh-my-zsh <span class="keyword">in</span> order to use all super cool aliases (glog glgga glg etc...)</span><br></pre></td></tr></table></figure>
<h2 id="Cloning-Repositories"><a href="#Cloning-Repositories" class="headerlink" title="Cloning Repositories"></a>Cloning Repositories</h2><p>1) cloning local repositories</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># testing features without creating a branch and if it works just create a branch and add features to it.</span></span><br><span class="line">$ git <span class="built_in">clone</span> MySuperRepo MySuperRepo-test</span><br><span class="line">$ <span class="built_in">cd</span> MySuperRepo-test</span><br><span class="line">$ git status</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>2) Cloning Remote Repositories over HTTPS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># By using lin on github for exemple</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github/com/blablabla/superrepo.git</span><br></pre></td></tr></table></figure>
<p>3) Forking</p>
<p>A fork is a copy of a repository.<br>Using fork to update a project or to start one based on another project.<br><a href="https://docs.github.com/en/free-pro-team@latest/github/getting-started-with-github/fork-a-repo" target="_blank" rel="noopener">Github docs</a></p>
<h2 id="Push-Pull-and-Tracking-Remote-Repositories"><a href="#Push-Pull-and-Tracking-Remote-Repositories" class="headerlink" title="Push, Pull, and Tracking Remote Repositories"></a>Push, Pull, and Tracking Remote Repositories</h2><p>1) Tracking Remotes Repositories</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsq -b 4096</span><br><span class="line">$ cat ~/.ssj/id_rsa.pub (and paste it on your github profile/settings/ssh key)</span><br><span class="line">$ git <span class="built_in">clone</span> git@github.com:linuxacademy/content-source-control-git.git (using git protocol to <span class="built_in">clone</span> over an ssh tunnel)</span><br><span class="line">$ <span class="built_in">cd</span> content-source-control-git</span><br><span class="line">$ git remote (origin)</span><br><span class="line">$ git remote -v</span><br><span class="line">$ git remote show origin (show more information)</span><br><span class="line">$ git fetch origin (keeps track changing on the remote server)</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure>
<p><em>what you pull down to the fetch command is no part of your local repository until you merge it</em><br><em>Git pull will let you know if your are up to date</em></p>
<p>2) Pushing to Remote Repositories</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> content-source-control-git</span><br><span class="line">$ git branch readme-updates</span><br><span class="line">$ git checkout readme-updates</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"blabla"</span> &gt;&gt; readme.md</span><br><span class="line">$ git commit <span class="_">-a</span> -m <span class="string">"update readme"</span></span><br><span class="line">$ git push -u origin readme-updates</span><br></pre></td></tr></table></figure>
<p>3) Pull Requests</p>
<p>PR are easy.<br>Check pull request from github web interface.<br>click new pull request and take a look.<br>check readme-upadtes commits and click on green button “pull request” and write a comment and create PR.<br>If no conflicts click on “merge pull request” confirm the merge and the PR is merge an close.<br>Going back to the code you can see that the readme file is correctly update from the remote repository.<br>Github make quite easy to create a PR and merging to your existing repository.<br>As long as your are a contributor to a project you will be able to create a PR.<br>The only way that you will be able to merge a pull request is if your are the maintainer or the owner of the project itself.</p>
<h2 id="Setting-Up-and-Using-a-GitLab-Server"><a href="#Setting-Up-and-Using-a-GitLab-Server" class="headerlink" title="Setting Up and Using a GitLab Server"></a>Setting Up and Using a GitLab Server</h2><p>Work in progress.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://about.gitlab.com/install/#debian</span></span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y curl openssh-server ca-certificates</span><br><span class="line">sudo apt-get install -y postfix</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://packages.gitlab.com/gitlab/gitlab-ce</span></span><br><span class="line">curl <span class="_">-s</span> https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</span><br></pre></td></tr></table></figure>
<h1 id="Next-Steps"><a href="#Next-Steps" class="headerlink" title="Next Steps"></a>Next Steps</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2019/11/24/Source-Control-with-Git/" data-id="clrv2dsh3003dfoiyr9do0udt" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-October-2019-inspiration" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/20/October-2019-inspiration/" class="article-date">
  <time datetime="2019-10-20T20:12:00.000Z" itemprop="datePublished">2019-10-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hexo/">Hexo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/20/October-2019-inspiration/">October 2019 inspiration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>One day I will work on this website….</p>
<p><strong>Back in the game xD</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep(42);</span><br></pre></td></tr></table></figure>
<p>Sleeping is not a crime.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2019/10/20/October-2019-inspiration/" data-id="clrv2dse20006foiyfktbbc2n" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Blog/">Blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Test/">Test</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2019-post" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/19/2019-post/" class="article-date">
  <time datetime="2019-10-19T20:42:42.000Z" itemprop="datePublished">2019-10-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/others/">others</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/19/2019-post/">2019_post</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Oh-Yeah"><a href="#Oh-Yeah" class="headerlink" title="Oh Yeah !!!"></a>Oh Yeah !!!</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21*2 = 42 !</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2019/10/19/2019-post/" data-id="clrv2dsd40000foiy5wdxnqwl" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/42/">42</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Univers/">Univers</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-sort-ip-address" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/16/sort-ip-address/" class="article-date">
  <time datetime="2018-12-16T13:32:00.000Z" itemprop="datePublished">2018-12-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Sysadmin-Tips-Tricks/">Sysadmin Tips & Tricks</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/16/sort-ip-address/">How to sort Apache / Nginx Ip adresses with grep and Co</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Here we are guys, just feel free to adapte $1 to your data</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'2018-12-16:14:'</span> access.log | awk <span class="string">'&#123;print $1&#125;'</span> | sort -n | uniq -c | sort -g | tail -n 10</span><br></pre></td></tr></table></figure>
<p>It will provide you the top 10 IPs Hits regarding what $1 is obviously.</p>
<p>\m/</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2018/12/16/sort-ip-address/" data-id="clrv2dsex000wfoiy9cchqi84" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/grep/">grep</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sort/">sort</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-post" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/16/post/" class="article-date">
  <time datetime="2018-12-16T12:55:00.000Z" itemprop="datePublished">2018-12-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hexo/">Hexo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/16/post/">2018 first commit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Wow ! This hexo blog is still up and working I can’t believe it.<br>So here is my first commit of 2018 :D \o/</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo go to sleep now ^^</span><br></pre></td></tr></table></figure>
<p>Let’s keep working on this repo and see you later folks !</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samedi 19 octobre 2019, 22:01:42 =&gt; and here we are &lt;=</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2018/12/16/post/" data-id="clrv2dsep000pfoiyb4suumcn" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Blog/">Blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Test/">Test</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hexo-how-to" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/10/hexo-how-to/" class="article-date">
  <time datetime="2017-04-10T20:42:00.000Z" itemprop="datePublished">2017-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hexo/">Hexo</a>►<a class="article-category-link" href="/categories/Hexo/How-to/">How to</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/10/hexo-how-to/">hexo how to</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Comment fonctionne ce site avec hexo:</strong></p>
<ul>
<li><p>hexo init ~/hexo (dans ma home pour pas m’embeter)</p>
</li>
<li><p>dans ~/hexo =&gt; npm install + tunning du config.yml qui va bien pour deployer via git par la suite.</p>
</li>
</ul>
<p><strong>Comment je créer un article:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new my-super-article</span><br><span class="line">hexo publish my-super-article</span><br></pre></td></tr></table></figure></p>
<p><strong>Comment Nginx fait le boulot:</strong></p>
<ul>
<li>Je crée un docroot vide =&gt; /var/www/hexo :)</li>
</ul>
<p><strong>Comment la magie opère:</strong></p>
<ul>
<li>git init –bare ~/hexo_bare (toujours à la racine pour pas m’embêter)</li>
<li>création d’un hook post-receive =&gt; git –work-tree=/var/www/hexo –git-dir=/home/$USER/hexo_bare checkout -f</li>
<li>Puis git clone <a href="https://github.com/n3ird4/n3ird4.github.io.git" target="_blank" rel="noopener">https://github.com/n3ird4/n3ird4.github.io.git</a> &amp;&amp; cd ~/n3ird4.github.io</li>
<li>git remote add live ~/hexo_bare </li>
</ul>
<p><strong>Comment je deploie:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br><span class="line"></span><br><span class="line">( <span class="built_in">cd</span> ~/n3ird4.github.io ; git pull ; git push live master )</span><br></pre></td></tr></table></figure>
<p>Et voila via un appel au script de deploiement le taf se fait dans le repertoire ~/hexo et la synchro du /var/www/hexo est donc automatiquent effectuée via le push qui va venir remplir le contenu du docroot via le hook !</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2017/04/10/hexo-how-to/" data-id="clrv2dsel000mfoiy4r915lep" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/githooks/">githooks</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-second-post" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/27/second-post/" class="article-date">
  <time datetime="2017-03-27T20:00:00.000Z" itemprop="datePublished">2017-03-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Hexo/">Hexo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/27/second-post/">second-post</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Bon ba c’est cool hexo mec</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://91.208.181.214/2017/03/27/second-post/" data-id="clrv2dset000sfoiyi7kfxprt" class="article-share-link">Partager</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Blog/">Blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Test/">Test</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Précédent</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Suivant &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWS/">AWS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AWS/AWS-Certified-Solutions-Architect-Associate-SAA-C02/">AWS Certified Solutions Architect Associate SAA-C02</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/">Ansible</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Ansible/Quick-Starts/">Quick Starts</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/TryHackMe-Anonymous/">TryHackMe Anonymous</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/TryHackMe-CMesS/">TryHackMe CMesS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/TryHackMe-Madness/">TryHackMe Madness</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/TryHackMe-Wgel/">TryHackMe Wgel</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ElasticSearch/">ElasticSearch</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ElasticSearch/Playing-with-Elastic-Stack-Modules/">Playing with Elastic Stack Modules</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Git/Source-Control-with-Git/">Source Control with Git</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/How-to/">How to</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/bye-bye-2023/">bye bye 2023</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/Reparation-de-replication-master-master-sans-lock/">Réparation de réplication master/master (sans lock)</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/Playing-with-Nginx-and-Dynamic-Modules/">Playing with Nginx and Dynamic Modules</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sysadmin-Tips-Tricks/">Sysadmin Tips & Tricks</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Sysadmin-Tips-Tricks/iowait/">iowait</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sysadmin-Tips-Tricks/swap/">swap</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Varnish/">Varnish</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Varnish/blocklist-IP-address-with-Varnish/">blocklist IP address with Varnish</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/42/">42</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/">AWS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/">Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FortyTwo/">FortyTwo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ModSecurity/">ModSecurity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Test/">Test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Univers/">Univers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/githooks/">githooks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grep/">grep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iotop/">iotop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iowait/">iowait</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swap/">swap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tryhackme/">tryhackme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/varnish/">varnish</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmstat/">vmstat</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/42/" style="font-size: 10px;">42</a> <a href="/tags/AWS/" style="font-size: 10px;">AWS</a> <a href="/tags/Ansible/" style="font-size: 10px;">Ansible</a> <a href="/tags/Blog/" style="font-size: 20px;">Blog</a> <a href="/tags/FortyTwo/" style="font-size: 10px;">FortyTwo</a> <a href="/tags/ModSecurity/" style="font-size: 10px;">ModSecurity</a> <a href="/tags/Test/" style="font-size: 20px;">Test</a> <a href="/tags/Univers/" style="font-size: 10px;">Univers</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/githooks/" style="font-size: 10px;">githooks</a> <a href="/tags/grep/" style="font-size: 10px;">grep</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/iotop/" style="font-size: 10px;">iotop</a> <a href="/tags/iowait/" style="font-size: 10px;">iowait</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/sort/" style="font-size: 10px;">sort</a> <a href="/tags/swap/" style="font-size: 10px;">swap</a> <a href="/tags/tryhackme/" style="font-size: 20px;">tryhackme</a> <a href="/tags/varnish/" style="font-size: 10px;">varnish</a> <a href="/tags/vmstat/" style="font-size: 10px;">vmstat</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">décembre 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">mars 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">novembre 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">octobre 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">septembre 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">juillet 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">mai 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">avril 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">novembre 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">octobre 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">décembre 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">avril 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">mars 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/12/27/seeyoulater/">seeyoulater</a>
          </li>
        
          <li>
            <a href="/2022/03/06/TryHackMe-Anonymous-Write-Up/">TryHackMe Anonymous Writeup</a>
          </li>
        
          <li>
            <a href="/2021/11/05/TryHackMe-CMesS-CTF-Write-Up/">TryHackMe CMesS CTF Write Up</a>
          </li>
        
          <li>
            <a href="/2020/10/27/TryHackMe-Madness-CTF-Write-Up/">TryHackMe Madness CTF Writeup</a>
          </li>
        
          <li>
            <a href="/2020/09/27/TryHackMe-Wgel-CTF-Write-Up/">TryHackMe Wgel CTF Writeup</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 n3ird4<br>
      Propulsé par <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/" target="_blank">Github</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>